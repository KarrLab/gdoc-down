machine:
  python:
    version: 2.7.12
  post:
    - pyenv global 2.7.12 3.5.2
dependencies:
  cache_directories:
    - /home/ubuntu/virtualenvs/venv-2.7.12
    - /opt/circleci/python/3.5.2
    - /opt/circleci/.pyenv/shims
  pre:
    - pip2 install -e .
    - pip3 install -e .

    - pip2 install -U -e git+https://github.com/KarrLab/Karr-Lab-build-utils.git#egg=Karr-Lab-build-utils
    - pip3 install -U -e git+https://github.com/KarrLab/Karr-Lab-build-utils.git#egg=Karr-Lab-build-utils
    
    - karr-lab-build-utils-2 install-requirements
    - karr-lab-build-utils-3 install-requirements

    - mkdir -p ${HOME}/.gdoc_down
    - echo $GCLOUD_SERVICE_KEY | base64 --decode > ${HOME}/.gdoc_down/service-key.json    
test:
  override:
    - karr-lab-build-utils-2 run-tests tests --with-xunit --with-coverage
    - karr-lab-build-utils-3 run-tests tests --with-xunit --with-coverage
  post:
    - karr-lab-build-utils make-and-archive-reports
